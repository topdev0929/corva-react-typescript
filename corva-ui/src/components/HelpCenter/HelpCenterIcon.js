import { createSvgIcon } from '@material-ui/core';
import HelpIcon from '@material-ui/icons/Help';
import moment from 'moment';

import { getLocalStorageItem } from '~/utils/localStorage';

const NewContentIcon = createSvgIcon(
  <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M15 4C15 6.76142 17.2386 9 20 9C20.5108 9 21.0036 8.92341 21.4678 8.7811C21.817 9.80819 22 10.8947 22 12C22 13.9778 21.4135 15.9112 20.3147 17.5557C19.2159 19.2002 17.6541 20.4819 15.8268 21.2388C13.9996 21.9957 11.9889 22.1937 10.0491 21.8078C8.10929 21.422 6.32746 20.4696 4.92894 19.0711C3.53041 17.6725 2.578 15.8907 2.19215 13.9509C1.8063 12.0111 2.00433 10.0004 2.76121 8.17316C3.51809 6.3459 4.79981 4.78412 6.4443 3.6853C8.08879 2.58649 10.0222 2 12 2C13.1053 2 14.1918 2.183 15.2189 2.53222C15.0766 2.99636 15 3.48923 15 4ZM13.05 17C13.05 17.3072 12.928 17.6018 12.7107 17.8191C12.4935 18.0363 12.1989 18.1583 11.8917 18.1583C11.5845 18.1583 11.2898 18.0363 11.0726 17.8191C10.8554 17.6018 10.7333 17.3072 10.7333 17C10.7333 16.6928 10.8554 16.3982 11.0726 16.1809C11.2898 15.9637 11.5845 15.8417 11.8917 15.8417C12.1989 15.8417 12.4935 15.9637 12.7107 16.1809C12.928 16.3982 13.05 16.6928 13.05 17ZM14.5 11.75C14.318 11.9101 14.1401 12.0508 13.973 12.1828C13.3749 12.6554 12.9167 13.0176 12.9167 13.7667V14.025C12.9167 14.0939 12.9031 14.1622 12.8767 14.2259C12.8503 14.2896 12.8117 14.3475 12.7629 14.3962C12.7141 14.445 12.6563 14.4837 12.5926 14.51C12.5289 14.5364 12.4606 14.55 12.3917 14.55H11.3917C11.3227 14.55 11.2545 14.5364 11.1908 14.51C11.1271 14.4837 11.0692 14.445 11.0204 14.3962C10.9717 14.3475 10.933 14.2896 10.9066 14.2259C10.8802 14.1622 10.8667 14.0939 10.8667 14.025C10.8597 13.6593 10.8876 13.2937 10.95 12.9333C11.198 11.7846 11.8447 11.2698 12.4898 10.7563L12.4898 10.7562C12.6684 10.6141 12.8468 10.472 13.0167 10.3167C13.2036 10.1738 13.3581 9.99307 13.4701 9.78624C13.5822 9.57942 13.6491 9.35123 13.6667 9.11666C13.6612 8.91591 13.6138 8.71851 13.5276 8.53712C13.4414 8.35573 13.3183 8.19436 13.1661 8.06333C13.0139 7.93231 12.836 7.83454 12.6438 7.77627C12.4516 7.71801 12.2493 7.70055 12.05 7.725C11.6634 7.68268 11.2747 7.78417 10.958 8.0101C10.6414 8.23603 10.4191 8.5706 10.3333 8.95C10.3139 9.06931 10.2532 9.17802 10.1618 9.2572C10.0704 9.33638 9.95421 9.38101 9.83334 9.38333H8.66667C8.59323 9.38262 8.52076 9.36651 8.45394 9.33604C8.38712 9.30557 8.32743 9.26143 8.27874 9.20645C8.23005 9.15147 8.19343 9.08689 8.17125 9.01688C8.14908 8.94687 8.14184 8.87298 8.15 8.8C8.425 6.85 10.0833 5.84167 12.1083 5.84167C14.2917 5.84167 15.8083 7.275 15.8083 9.1C15.8087 9.61257 15.6908 10.1183 15.4639 10.5779C15.237 11.0375 14.9071 11.4386 14.5 11.75Z"
    />
    <path
      d="M16 4C16 1.79086 17.7909 0 20 0C22.2091 0 24 1.79086 24 4C24 6.20914 22.2091 8 20 8C17.7909 8 16 6.20914 16 4Z"
      fill="#75DB29"
    />
  </svg>,
  'NewContentIcon'
);

export function HelpCenterIcon({ appId, helpContentUpdatedAt }) {
  const helpCenterLastOpenedAt = getLocalStorageItem('helpCenter')?.[appId];

  const isNewContent =
    helpContentUpdatedAt &&
    (!helpCenterLastOpenedAt || moment(helpCenterLastOpenedAt).isBefore(helpContentUpdatedAt));

  const Icon = isNewContent ? NewContentIcon : HelpIcon;

  return <Icon />;
}
